---
# Copy over and extract the ACS sources.
# Created: Mon Sep  2 15:30:28 EDT 2013

- name: Don't overwrite existing sources.
  command: /usr/bin/test -d {{ AOL_SERVER_WEBROOT }}/{{ DOMAIN_NAME }}
  register: acs_sources_exist
  ignore_errors: True

- name: Copy the ACS source tarball to the destination host.
  copy: src=acs-{{ ACS_VERSION }}.tgz dest=/tmp
          owner={{ AOL_SERVER_USER }} group={{ AOL_SERVER_USER }} mode=644
  when: acs_sources_exist|failed

- name: Extract the ACS sources.
  command: tar -zxf /tmp/acs-{{ ACS_VERSION }}.tgz -C {{ AOL_SERVER_WEBROOT }}
  when: acs_sources_exist|failed

- name: Rename ACS sources to use our domain name.
  command: mv {{ AOL_SERVER_WEBROOT }}/acs {{ AOL_SERVER_WEBROOT }}/{{ DOMAIN_NAME }}
  when: acs_sources_exist|failed

# XXX: figure out what mode to give to files and directories
- name: Change permissions on extracted file to AOL server user.
  file: path={{ AOL_SERVER_WEBROOT }}/{{ DOMAIN_NAME }} state=directory 
          owner={{ AOL_SERVER_USER }} group={{ WEB_GROUP }} 
          recurse=yes
  when: acs_sources_exist|failed
